<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>VOR Rehabilitación - Sistema de Entrenamiento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1>VOR Rehabilitación</h1>
      <div class="level-indicator">
        <span>Nivel: <span id="currentLevel">1</span></span>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
      </div>
    </header>

    <!-- Main Interface -->
    <div id="mainInterface" class="main-interface">
      <div class="control-panel">
        <div class="exercise-selector">
          <h3>Seleccionar Ejercicio</h3>
          <div class="exercise-buttons">
            <button id="btnLevel1" class="exercise-btn active">Nivel 1: Fijación Central</button>
            <button id="btnLevel2" class="exercise-btn">Nivel 2: Movimiento Horizontal</button>
            <button id="btnLevel3" class="exercise-btn">Nivel 3: Movimiento Vertical</button>
            <button id="btnLevel4" class="exercise-btn">Nivel 4: Movimiento Diagonal</button>
            <button id="btnLevel5" class="exercise-btn">Nivel 5: Seguimiento Complejo</button>
          </div>
        </div>

        <div class="session-controls">
          <button id="btnCalibrate" class="btn-primary">Calibrar Sistema</button>
          <button id="btnStart" class="btn-success">Iniciar Ejercicio</button>
          <button id="btnPause" class="btn-warning" disabled>Pausar</button>
          <button id="btnStop" class="btn-danger" disabled>Detener</button>
        </div>
        
        <div class="calibration-info">
          <h4>Estado de Calibración</h4>
          <div class="calibration-status">
            <div class="status-item">
              <label>Estado:</label>
              <span id="calibrationState" class="status-value">No calibrado</span>
            </div>
            <div class="status-item">
              <label>Precisión:</label>
              <span id="currentPrecision" class="status-value">-</span>
            </div>
          </div>
        </div>

        <div class="metrics-panel">
          <h4>Métricas en Tiempo Real</h4>
          <div class="metrics-grid">
            <div class="metric">
              <label>Estabilidad de Fijación:</label>
              <span id="fixationStability" class="metric-value">-</span>
            </div>
            <div class="metric">
              <label>Precisión VOR:</label>
              <span id="vorAccuracy" class="metric-value">-</span>
            </div>
            <div class="metric">
              <label>Tiempo en Objetivo:</label>
              <span id="timeOnTarget" class="metric-value">-</span>
            </div>
            <div class="metric">
              <label>Puntuación:</label>
              <span id="currentScore" class="metric-value score">0</span>
            </div>
          </div>
        </div>
      </div>

      <div class="exercise-area">
        <div id="exerciseInstructions" class="instructions">
          <h3>Instrucciones</h3>
          <p>Selecciona un nivel para comenzar el entrenamiento VOR.</p>
        </div>
        <div id="targetArea" class="target-area">
          <div id="fixationTarget" class="fixation-target"></div>
          <div id="gazeIndicator" class="gaze-indicator"></div>
        </div>
      </div>
    </div>

    <!-- Calibration Overlay -->
    <div id="calibrationOverlay" class="calibration-overlay">
      <div class="calibration-content">
        <h2 id="calibrationTitle">Calibración del Sistema</h2>
        <p id="calibrationInstructions">Mira fijamente cada punto que aparezca y mantén la mirada durante 2 segundos.</p>
        <div id="calibrationGrid" class="calibration-grid"></div>
        <div class="calibration-progress">
          <span id="calibrationStatus">Preparando calibración...</span>
          <div id="precisionResults" class="precision-results" style="display:none;">
            <h3>Resultados de Precisión</h3>
            <div class="precision-metric">
              <label>Precisión Promedio:</label>
              <span id="avgPrecision" class="precision-value">-</span>
            </div>
            <div class="precision-actions">
              <button id="btnAcceptCalibration" class="btn-success">Aceptar Calibración</button>
              <button id="btnRecalibrate" class="btn-warning">Recalibrar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal">
      <div class="modal-content">
        <h2>Resultados del Ejercicio</h2>
        <div id="resultsContent" class="results-content"></div>
        <div class="modal-actions">
          <button id="btnExport" class="btn-secondary">Exportar Datos</button>
          <button id="btnNewSession" class="btn-primary">Nueva Sesión</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.8.1/localforage.js"></script>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
  
  <script src="js/config.js"></script>
  <script src="js/eyetracking.js"></script>
  <script src="js/exercises.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>
</body>
</html>